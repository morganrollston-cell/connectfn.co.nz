<!doctype html>
<html lang="en">
<head>
  <script>window.__variant="B";</script>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NJ76GXDB');</script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#00467F">
  <title>Free Property Appraisal — First National Connect</title>
  <meta name="description" content="Free expert appraisal with insight into your home’s value, the current Nelson/Tasman market, and a strategy to maximise your sale price.">

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon.PNG">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon.PNG">
  <link rel="shortcut icon" href="assets/images/favicon.PNG">
  <link rel="apple-touch-icon" href="assets/images/favicon.PNG">
  <meta name="msapplication-TileImage" content="assets/images/favicon.PNG">

  <style>
    *,*::before,*::after{box-sizing:border-box}
    html{-webkit-text-size-adjust:100%}
    body{ margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height:1.5; color:#0b1e37; background:#000; font-size: clamp(15px,1.6vw,17px); }
    a{color:#00467F;text-decoration:none}
    :root{ --brand:#00467F; --accent:#0A84FF; --border:#e6edf5; --muted:#64748b; --radius:16px; --shadow:0 18px 48px rgba(0,0,0,.28); }

    .page-bg{ position:fixed; inset:0; z-index:-2;
      background: linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.25)),
                  url('assets/images/Header-image.jpg') center/cover no-repeat; }

    /* Header */
    .site-header{ position:sticky; top:0; z-index:10; background: rgba(255,255,255,.98);
      border-bottom:1px solid var(--border); box-shadow: 0 2px 10px rgba(0,0,0,.06); }
    .site-header__inner{ display:flex; justify-content:center; align-items:center; padding: 8px 16px; }
    .site-header__logo img{ height: clamp(72px,8vw,120px); width:auto; display:block; }

    /* Centered card */
    main{ min-height: calc(100svh - 56px - 56px); display:grid; place-items:center; padding: clamp(14px,3vw,28px); }
    .card{
      position: relative;      /* anchor (kept harmlessly) */
      width:100%; max-width:520px;
      background:#fff; border:1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
      overflow: visible;
    }
    .card__body{ padding: clamp(18px,3.4vw,28px); }

    .eyebrow{ display:inline-block; background:#00467F; color:#fff; padding:6px 10px; border-radius:999px;
      font-weight:800; font-size:.85rem; letter-spacing:.2px; margin-bottom:10px; }
    h1{ margin:.2rem 0 .35rem; font-size: clamp(22px,3.6vw,30px); line-height:1.15; color:#0b1e37; font-weight:900; }
    .lede{ margin:0 0 10px; color:#344861 }
    .bullets{ margin:8px 0 12px; padding-left:1.1rem; color:#223046 }
    .bullets li{ margin:.25rem 0 }

/* Title pill */
.bullets-title {
  display: inline-block;
  background: rgba(10,132,255,0.08); /* light transparent blue */
  color: #0b1e37;
  font-weight: 800;
  font-size: .95rem;
  padding: 6px 14px;
  border-radius: 999px;
  margin-bottom: 10px;
  text-align: center;
}

/* Bullet list with ticks */
.bullets {
  list-style: none;
  margin: 0;
  padding: 0;
  text-align: center;   /* center the list block */
}

.bullets li {
  position: relative;
  padding-left: 1.6rem;
  margin: .5rem 0;
  text-align: left;     /* text itself left-aligned */
  display: inline-block; /* keeps list centered under title */
}

.bullets li::before {
  content: "✓";
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  color: #16a34a; /* green tick */
  font-weight: 900;
  font-size: 1.2rem;
}

    /* Agent mini */
    .agent-mini{ margin:10px 0 6px; }
    .agent-mini__title{ margin:0 0 8px; font-weight:800; font-size:.95rem; color:#0b1e37; text-align:center; }
    .agent-mini__row{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .agent-mini__item{ display:grid; grid-template-columns:auto 1fr; align-items:center; gap:8px; min-width:0; }
    .agent-mini__item img{ width:42px; height:42px; border-radius:50%; object-fit:cover; box-shadow:0 2px 6px rgba(0,0,0,.08); }
    .agent-mini__meta{ display:grid; min-width:0; line-height:1.15; }
    .agent-mini__name{ font-weight:800; font-size:.92rem; color:#0b1e37; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .agent-mini__role{ font-size:.75rem; color:#64748b; }
    @media (max-width: 480px){ .agent-mini__name{ white-space:normal; overflow:visible; text-overflow:unset; } }

    /* Form */
    form{ display:grid; gap:14px; margin-top:8px }
    label{ display:grid; gap:6px; font-weight:700; color:#0b1e37 }
    input{ background:#fff; border:1px solid #dfe7f0; border-radius:12px; padding:12px; font-size:16px; min-height:44px; }
    input:focus{ border-color:#7cc4ff; outline:0; box-shadow:0 0 0 4px rgba(124,196,255,.25); }

    .timeframe-pills{ display:flex; flex-wrap:wrap; gap:8px; margin:2px 0 4px; }
    .timeframe-pills input{ display:none }
    .timeframe-pills label{ border:1px solid #dbe3ef; border-radius:999px; cursor:pointer; font-weight:600; }
    .timeframe-pills label span{ display:block; padding:10px 14px; border-radius:999px; }
    .timeframe-pills input:checked + span{ background:#0A84FF; color:#fff; border-color:#0A84FF; box-shadow:0 4px 12px rgba(10,132,255,.26); }

    .btn{ display:inline-block; border:0; border-radius:12px; padding:14px 20px; font-weight:800; letter-spacing:.2px; cursor:pointer; min-height:48px; font-size:18px; }
    .btn.primary{ background:var(--accent); color:#fff; box-shadow:0 10px 28px rgba(10,132,255,.28) }
    .btn[disabled]{ opacity:.6; cursor:not-allowed }
    .fine{ margin:2px 0 0; font-size:12px; color:#0b1e37a6 }

    /* Progress */
    .progress{ position:relative; margin:10px 0 12px; }
    .progress-title{ font-weight:800; color:#0b1e37; font-size:.95rem; margin-bottom:6px; text-align:center; }
    .progress-row{ display:grid; grid-template-columns:auto 1fr; align-items:center; gap:10px; }
    .progress-label{ font-weight:800; color:#f5a300; white-space:nowrap; }
    .progress-bar{ position:relative; height:10px; border-radius:999px; overflow:hidden; background:#edf2f7; border:1px solid #e6edf5; }
    .progress-fill{ position:absolute; inset:0 auto 0 0; width:0%; background: linear-gradient(90deg,#0A84FF,#7c3aed 60%,#14b8a6); border-right:1px solid rgba(255,255,255,.6); transition: width .25s ease; }

    /* Footer (full) */
    .footer{ background:#0b4a7a; color:#e7f1fb; margin-top:40px; }
    .footer a{ color:#e7f1fb; text-decoration:none }
    .footer a:hover{ text-decoration:underline }
    .footer__top{ max-width:1120px; margin:0 auto; padding:48px 16px 36px; text-align:center; }
    .footer__logo{ height:120px; width:auto; display:block; margin:0 auto 30px; filter: brightness(0) invert(1); }
    .footer__contact{ list-style:none; padding:0; margin:0 0 24px; display:grid; gap:8px; justify-items:center; font-size: clamp(16px,1.8vw,18px); }
    .footer__nav{ display:flex; gap:40px; justify-content:center; flex-wrap:wrap; letter-spacing:.08em; font-weight:600; margin-top:10px; text-transform:uppercase; }
    .footer__bottom{ background: linear-gradient(180deg, rgba(0,0,0,.06), rgba(0,0,0,.12)); border-top:1px solid rgba(255,255,255,.15); text-align:center; padding:18px 16px 26px; font-size:14px; color:#cfe0f3; }
    .footer__bottom p{ margin:6px 0 } .footer__bottom a{ color:#cfe0f3 }

    @media (max-width:100vw){ .footer__logo{ height:80px } .footer__nav{ gap:22px } }

/* Center label text but keep input full width */
.step label {
  text-align: center;
  font-weight: 700;
  display: block;
}

.step label input {
  display: block;
  width: 100%;
  margin-top: 6px;   /* small gap between label text and input */
  text-align: left;  /* make sure typed text stays left aligned */
}

/* Add more spacing around agent section */
.agent-mini {
  margin: 24px 0;  /* top and bottom spacing */
}

/* Airy progress header */
.progress-stack{
  display:grid;
  gap:12px;
  margin: 18px 0 14px;
}
.progress-stack .form-title{
  margin:0;
  text-align:center;
  font-size:1.15rem;
  font-weight:900;
  color:#0b1e37;
}
.bar-row{
  display:grid;
  grid-template-columns:auto 1fr;
  align-items:center;
  gap:12px;
}
.bar-row .step-label{
  font-weight:800;
  color:#f5a300;
  white-space:nowrap;
}

.bar-row{
  display:grid;
  grid-template-columns:auto 1fr;
  align-items:center;
  gap:12px;
  margin: 8px 0;                 /* space above/below the bar */
}

.progress-bar.slim{
  width:100%;                     /* ensures it stretches full width */
  height:10px;                    /* a bit taller so it’s visible */
  border-radius:999px;
  background:#e7eef6;             /* slightly darker track */
  border:1px solid #dbe3ef;
  position:relative;
  overflow:hidden;
}

.progress-bar.slim .progress-fill{
  position:absolute; inset:0 auto 0 0;
  width:0%;                       /* JS will update this */
  background:#0A84FF;
  border-right:1px solid rgba(255,255,255,.6);
}

/* Input label centered, field still full-width (keeps the flow) */
.step label{
  display:block;
  text-align:center;
}
.step label input{
  width:100%;
  display:block;
  margin-top:8px;
  text-align:left;
}

/* Pill box for form title */
.progress-pill {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: rgba(10,132,255,0.1); /* light blue transparent */
  color: #0b1e37;
  font-weight: 800;
  font-size: 1rem;
  padding: 6px 14px;
  border-radius: 999px;
  margin: 14px auto;
  text-align: center;
}

/* Arrows inside the pill */
.progress-pill .arrow {
  font-size: 1.2rem;
  color: var(--accent);
  font-weight: 900;
  line-height: 1;
}

/* Center the agents title with underline */
.agent-mini__title {
  margin: 0 auto 16px;           /* auto left/right centers the block */
  font-weight: 800;
  font-size: 1rem;
  color: #0b1e37;
  text-align: center;
  border-bottom: 3px solid var(--accent);
  display: table;                /* makes the underline hug text but allows centering */
  padding-bottom: 4px;
}

/* Make the timeframe pills nicely centered */
.timeframe-pills {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;   /* <-- center them */
  gap: 12px;                 /* spacing between pills */
  margin: 12px 0 16px;       /* more breathing room */
  text-align: center;
}

.timeframe-pills label {
  border: 1px solid #dbe3ef;
  border-radius: 999px;
  cursor: pointer;
  font-weight: 600;
  text-align: center;
}

.timeframe-pills label span {
  display: block;
  padding: 12px 18px;        /* make pills chunkier */
  border-radius: 999px;
  min-width: 100px;          /* consistent width so they line up */
}

.timeframe-pills input:checked + span {
  background: #0A84FF;
  color: #fff;
  border-color: #0A84FF;
  box-shadow: 0 4px 12px rgba(10,132,255,.26);
}

/* Hide the default radio circle completely */
.timeframe-pills input[type="radio"] {
  display: none;   /* removes the default circle */
}

/* Make the pill the clickable target */
.timeframe-pills label {
  cursor: pointer;
  border-radius: 999px;
  font-weight: 600;
  overflow: hidden;
}

.timeframe-pills label span {
  display: block;
  padding: 12px 20px;
  border-radius: 999px;
  border: 1px solid #dbe3ef;
  background: #fff;
  transition: all 0.2s ease;
  min-width: 110px;       /* keeps pills consistent */
  text-align: center;
}

/* Selected pill */
.timeframe-pills input[type="radio"]:checked + span {
  background: #0A84FF;
  color: #fff;
  border-color: #0A84FF;
  box-shadow: 0 4px 10px rgba(10,132,255,.25);
}
    [hidden]{ display:none !important; }
  </style>
</head>
<body>
  <div class="page-bg" aria-hidden="true"></div>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJ76GXDB" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <!-- Header -->
  <header class="site-header">
    <div class="site-header__inner">
      <a class="site-header__logo" href="#">
        <img src="assets/images/Full-logo-blue.svg" alt="First National Connect Logo">
      </a>
    </div>
  </header>

  <main>
    <div class="card">
      <div class="card__body">
        <span class="eyebrow">Spring promo</span>
        <h1>Get your Free Property Appraisal & go in the draw to win up to $5,000</h1>
        <p class="lede">Fast, expert valuation of your Nelson/Tasman property with clear next steps to maximise your result.</p>
    <div class="bullets-block" style="text-align:center">
  <span class="bullets-title">Our Free Appraisal Includes</span>
  <ul class="bullets">
    <li>60-second booking</li>
    <li>Local specialists</li>
    <li>Clear valuation + plan</li>
  </ul>
</div>

        <section class="agent-mini" aria-label="Your local Nelson/Tasman agents">
          <p class="agent-mini__title">Your local Nelson/Tasman agents</p>
          <div class="agent-mini__row">
            <div class="agent-mini__item">
              <img src="assets/images/Penelope-profile.svg" alt="Penelope Rollston">
              <div class="agent-mini__meta">
                <span class="agent-mini__name">Penelope Rollston</span>
                <span class="agent-mini__role">Principal Broker</span>
              </div>
            </div>
            <div class="agent-mini__item">
              <img src="assets/images/Kimallred-headshot.svg" alt="Kim Allred">
              <div class="agent-mini__meta">
                <span class="agent-mini__name">Kim Allred</span>
                <span class="agent-mini__role">Sales Consultant</span>
              </div>
            </div>
          </div>
        </section>

       <!-- Progress (replace your existing .progress block with this) -->
<section class="progress-stack">
  <div class="progress-pill">
  <span class="arrow">↓</span>
  Complete the quick form below
  <span class="arrow">↓</span>
</div>
</section>

        <!-- Form (5 steps) -->
        <form id="leadForm" name="Leads Spring Promo (Split Test)" method="POST" data-netlify="true" netlify-honeypot="bot-field" novalidate>
          <input type="hidden" name="form-name" value="Leads Spring Promo (Split Test)">
          <p style="display:none;"><label>Don’t fill this out: <input name="bot-field"></label></p>

          <input type="hidden" name="variant" value="B">
          <input type="hidden" name="page_url" value="">
          <input type="hidden" name="submitted_at" value="">
          <input type="hidden" name="utm_source" value="">
          <input type="hidden" name="utm_medium" value="">
          <input type="hidden" name="utm_campaign" value="">

          <div class="steps">
            <!-- 1: Address -->
            <div class="step" data-step="1">
              <label for="address">Property address for appraisal
                <input id="address" type="text" name="address" placeholder="e.g., 10 Example St, Richmond"
                       autocomplete="street-address" inputmode="text" required>
              </label>
            </div>

            <div class="step" data-step="2" hidden>
              <label for="full_name">Your full name
                <input id="full_name" type="text" name="full_name" autocomplete="name" inputmode="text" minlength="2" required>
              </label>
            </div>

            <div class="step" data-step="3" hidden>
              <label for="email">Email for your free report
                <input id="email" type="email" name="email" autocomplete="email" inputmode="email" required>
              </label>
            </div>

            <div class="step" data-step="4" hidden>
              <label for="phone">Best contact number
                <input id="phone" type="tel" name="phone" autocomplete="tel" inputmode="tel"
                       pattern="^[0-9+ ()-]{7,}$" placeholder="e.g., 027 123 4567" required>
              </label>
            </div>

            <div class="step" data-step="5" hidden>
              <label>When are you planning to sell?</label>
              <div class="timeframe-pills">
                <label><input type="radio" name="timeframe" value="Now" required><span>Now</span></label>
                <label><input type="radio" name="timeframe" value="1–3 months"><span>1–3 months</span></label>
                <label><input type="radio" name="timeframe" value="3–6 months"><span>3–6 months</span></label>
                <label><input type="radio" name="timeframe" value="Just curious"><span>Just curious</span></label>
              </div>
            </div>
          </div>

<!-- progress bar sits between fields and buttons -->
<div class="bar-row">
  <div class="step-label" id="stepLabel">Step 1 of 5</div>
  <div class="progress-bar slim"
       role="progressbar"
       aria-valuemin="0"
       aria-valuemax="5"
       aria-valuenow="0"
       aria-label="Form progress">
    <span class="progress-fill" style="width:0%"></span>
  </div>
</div>
          <button type="button" class="btn primary" id="nextBtn">Continue</button>
          <button type="submit" class="btn primary" id="submitBtn" hidden>Submit</button>

          <p class="fine">By submitting, you agree to our T&Cs and Privacy Policy.</p>
        </form>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer__top">
      <img class="footer__logo" src="assets/images/Full-logo-blue.svg" alt="First National Connect">
      <ul class="footer__contact">
        <li><a href="tel:0273594558">027 359 4558</a></li>
        <li><a href="mailto:penelope@fnconnect.co.nz">penelope@fnconnect.co.nz</a></li>
        <li>Collingwood Street Nelson 7010</li>
      </ul>
      <nav class="footer__nav" aria-label="Footer">
        <a href="/spring-campaign">SPRING CAMPAIGN INFO</a>
        <a href="https://www.facebook.com/peneloperollstonfirstnationalconnect" target="_blank" rel="noopener">FACEBOOK</a>
        <a href="https://www.instagram.com/firstnationalconnect/" target="_blank" rel="noopener">INSTAGRAM</a>
      </nav>
    </div>
    <div class="footer__bottom">
      <p>Copyright © 2025. First National Connect Licensed REA 2008, All rights reserved.</p>
      <p>Powered by Rollston Scaling.</p>
      <p>
        <a href="/complaints-process">Terms & Conditions</a> |
        <a href="/privacy-policy">Privacy Policy</a> |
      </p>
    </div>
  </footer>

  <!-- Stepper + Netlify submit + GTM push -->
  <script>
(function(){
  function hydrateHiddenFields(form){
    const u = new URL(window.location.href);
    form.querySelector('input[name="page_url"]').value     = u.origin + u.pathname;
    form.querySelector('input[name="submitted_at"]').value = new Date().toISOString();
    form.querySelector('input[name="utm_source"]').value   = u.searchParams.get('utm_source')   || '';
    form.querySelector('input[name="utm_medium"]').value   = u.searchParams.get('utm_medium')   || '';
    form.querySelector('input[name="utm_campaign"]').value = u.searchParams.get('utm_campaign') || '';
  }

  function thankYouHTML(firstName){
    const first = (firstName||'Thanks').toString().trim().split(' ')[0];
    return `
      <div class="card__body" style="text-align:center">
        <h3 style="margin:0 0 6px;color:#0b1e37;">${first}, we’ve got your request ✅</h3>
        <p style="margin:0;color:#344861;">We’ll be in touch shortly to confirm a time that suits.</p>
      </div>
    `;
  }

  function firstInvalid(el){ return el.querySelector(':invalid'); }

  // --- GTM helpers ---
  function pushLeadAttempt(){
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
      event: 'lead_submit_attempt',
      variant: window.__variant || 'B'
    });
    console.log('[GTM] lead_submit_attempt pushed');
  }

  function pushLeadSuccess(fd){
    try{
      const full = (fd.get('full_name')||'').toString().trim();
      const [first_name, ...rest] = full.split(' ');
      const last_name = rest.join(' ') || '';
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({
        event:'lead_submit_success',
        variant: window.__variant || 'B',
        form_name: 'Leads Spring Promo (Split Test)',
        enhanced_conversion_data:{
          email:(fd.get('email')||'').toString().trim().toLowerCase(),
          phone_number:(fd.get('phone')||'').toString().trim(),
          first_name,last_name,
          home_address:{street:(fd.get('address')||'').toString(), country:'NZ'}
        }
      });
      console.log('[GTM] lead_submit_success pushed', {
        email:(fd.get('email')||'').toString().trim().toLowerCase()
      });
    }catch(e){
      console.warn('[GTM] success push failed', e);
    }
  }

  function pushLeadError(err){
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
      event:'lead_submit_error',
      variant: window.__variant || 'B',
      error_message: (err && err.message) ? err.message : String(err)
    });
    console.warn('[GTM] lead_submit_error pushed', err);
  }

  document.addEventListener('DOMContentLoaded', function(){
    const form = document.getElementById('leadForm');
    const holder = form.closest('.card');
    const steps = Array.from(form.querySelectorAll('[data-step]'));
    const stepLabel = document.getElementById('stepLabel');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');

    const bar  = document.querySelector('.progress-bar');
    const fill = document.querySelector('.progress-fill');

    let i = 0; // current step

    function showStep(n){
      i = Math.max(0, Math.min(n, steps.length-1));
      steps.forEach((s, idx)=> s.hidden = idx !== i);
      if (stepLabel) stepLabel.textContent = `Step ${i+1} of ${steps.length}`;
      const last = (i === steps.length-1);
      nextBtn.hidden   =  last;
      submitBtn.hidden = !last;

      const pct = (i / steps.length) * 100;
      if (fill) fill.style.width = pct + '%';
      if (bar){
        bar.setAttribute('aria-valuenow', String(i));
        bar.setAttribute('aria-valuetext', `Completed ${i} of ${steps.length}`);
      }
      const inp = steps[i].querySelector('input,select,textarea,button');
      inp && inp.focus({preventScroll:true});
    }

    function canAdvance(){
      const cur = steps[i];
      const bad = firstInvalid(cur) || [...cur.querySelectorAll('[required]')]
        .find(el => !String(el.value||'').trim());
      if (bad){
        bad.focus(); form.reportValidity();
        cur.scrollIntoView({behavior:'smooth', block:'center'});
        return false;
      }
      return true;
    }

    nextBtn.addEventListener('click', ()=>{ if (canAdvance()) showStep(i+1); });

    form.addEventListener('keydown', e=>{
      if (e.key === 'Enter' && e.target.type !== 'submit'){ e.preventDefault(); }
    });

    hydrateHiddenFields(form);
    showStep(0);

    // --- Submit handler with GTM pushes ---
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if (!form.checkValidity()){
        const bad = firstInvalid(form); bad?.focus(); form.reportValidity();
        return;
      }

      pushLeadAttempt(); // fire attempt immediately

      const orig = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = submitBtn.dataset.loadingText || 'Submitting…';

      try{
        const fd = new FormData(form);
        if (!fd.get('form-name')) {
          fd.set('form-name', form.getAttribute('name') || 'Leads Spring Promo (Split Test)');
        }

        // Build x-www-form-urlencoded body (Netlify)
        const obj = {}; fd.forEach((v,k)=>obj[k]=v);
        const encoded = Object.keys(obj).map(k=>encodeURIComponent(k)+'='+encodeURIComponent(obj[k])).join('&');

        const res = await fetch('/', {
          method:'POST',
          headers:{'Content-Type':'application/x-www-form-urlencoded'},
          body: encoded
        });

        if (!res.ok) throw new Error('Netlify ' + res.status);

        // Success (network)
        pushLeadSuccess(fd);

        // Safety: if anything breaks after this, still record conversion
        holder.innerHTML = thankYouHTML(fd.get('full_name'));
        // Push again after the UI swap (idempotent in GA4)
        pushLeadSuccess(fd);

      }catch(err){
        pushLeadError(err);
        alert('Sorry, something went wrong. Please try again.');
        console.error(err);
        submitBtn.disabled = false; submitBtn.textContent = orig;
      }
    });
  });
})();
</script>

  <!-- Google Places -->
  <script>
    function initAddressAutocomplete(){
      const options = {
        fields: ['formatted_address','address_components','geometry'],
        types: ['address'],
        componentRestrictions: { country: ['nz'] }
      };
      const input = document.getElementById('address');
      if (!input) return;
      const ac = new google.maps.places.Autocomplete(input, options);
      ac.addListener('place_changed', ()=>{
        const p = ac.getPlace();
        if (p && p.formatted_address) input.value = p.formatted_address;
      });
      input.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter'){
          const dd = document.querySelector('.pac-container');
          const open = dd && getComputedStyle(dd).display !== 'none';
          if (open) e.preventDefault();
        }
      });
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBN9ItH4RG4IAaS6zPRpP6n19Qi8iBU_nE&libraries=places&callback=initAddressAutocomplete"></script>
</body>
</html>